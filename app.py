import os
import uuid
import streamlit as st
import speech_recognition as sr
from groq import Groq
from streamlit_chat import message
import tempfile

# Initialize Groq API client
client = Groq(
    api_key='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',
)

ACTION_WORDS = {"boil", "chop", "stir", "mix", "add", "serve", "bake", "fry", "blend", "simmer", "pour"}

def calculate_attention_weight(step):
    """
    Calculates self-attention scores for each step based on the number of action words.
    """
    words = step.lower().split()
    attention_weight = sum(1 for word in words if word in ACTION_WORDS)
    return attention_weight / len(words) if words else 0  # Normalize weight

def apply_attention_mechanism(recipe_text):
    """
    Highlights important steps based on self-attention scores.
    """
    step_lines = recipe_text.split("\n")
    attention_scores = [calculate_attention_weight(step) for step in step_lines]
    
    # Normalize scores to a 0-1 range
    max_score = max(attention_scores) if attention_scores else 1
    normalized_scores = [score / max_score for score in attention_scores]
    
    highlighted_steps = []
    for step, score in zip(step_lines, normalized_scores):
        if score >= 0.7:  # High attention
            formatted_step = f"ЁЯФе {step.upper()}"  # Emphasize with uppercase
        elif score >= 0.3:  # Medium attention
            formatted_step = f"тнР {step}"  # Highlight with a star
        else:  # Low attention
            formatted_step = step
        highlighted_steps.append(formatted_step)
    
    return "\n".join(highlighted_steps)


# Language selection dropdown with additional languages
languages = ["English", "родрооро┐ро┤рпН", "Franc╠зaise", "р┤ор┤▓р┤пр┤╛р┤│р┤В", "р░др▒Жр░▓р▒Бр░Чр▒Б", "р▓Хр▓ир│Нр▓ир▓б", "рд╣рд┐рдиреНрджреА"]
language_option = st.selectbox(
    "Select Language / роорпЖро╛ро┤ро┐ропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН / Se╠Бlectionner la langue / р┤нр┤╛р┤╖ р┤др┤┐р┤░р┤Юр╡Нр┤Юр╡Жр┤Яр╡Бр┤Хр╡Нр┤Хр╡Бр┤Х / р░нр░╛р░╖р░ир▒Б р░Ор░Вр░Ър▒Бр░Хр▒Лр░Вр░бр░┐ / р▓нр▓╛р▓╖р│Жр▓пр▓ир│Нр▓ир│Б р▓Жр▓пр│Нр▓Хр│Жр▓ор▓╛р▓бр▓┐ / рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВ:",
    languages,
    index=0,
)

# --- TTS audio functions removed ---

def get_recipe(recipe_name):
    if language_option == "родрооро┐ро┤рпН":
        prompt_template = f"""
        роирпАроЩрпНроХро│рпН роТро░рпБ родрпЖро╛ро┤ро┐ро▓рпНроорпБро▒рпИ роЪроорпИропро▓рпНроХро╛ро░ро░рпН рооро▒рпНро▒рпБроорпН роЪроорпИропро▓рпН роЙродро╡ро┐ропро╛ро│ро░рпН. роЙроЩрпНроХро│рпН рокрогро┐, родрпЖро│ро┐ро╡ро╛рой ро╡ро┤ро┐роорпБро▒рпИроХро│рпН, ро╡роХрпИрокрпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯ рокроЯро┐роХро│рпН рооро▒рпНро▒рпБроорпН роородро┐рокрпНрокро┐роЯрокрпНрокроЯрпНроЯ роХро╛ро▓ роЕро│ро╡рпБроХро│рпБроЯройрпН роТро░рпБ роХроЯрпНроЯроорпИроХрпНроХрокрпНрокроЯрпНроЯ, рокроЯро┐рокрпНрокроЯро┐ропро╛рой роЪрпЖропрпНроорпБро▒рпИ ро╡ро┤ро┐роХро╛роЯрпНроЯро┐ропрпИ ро╡ро┤роЩрпНроХрпБро╡родро╛роХрпБроорпН.

        роЪрпЖропрпНроорпБро▒рпИ рокрпЖропро░рпН: {recipe_name}

        роЙро│рпНро│рпАроЯрпНроЯрпБ рокрогро┐: роТро░рпБ роХрокрпН родрпЗроирпАро░рпН родропро╛ро░ро┐роХрпНроХро╡рпБроорпН
        ро╡рпЖро│ро┐ропрпАроЯрпБ: ро╡ро┤ро┐роорпБро▒рпИроХро│ро┐ройрпН ро╡ро░ро┐роЪрпИ:
        
        1. ро╡ро┤ро┐роорпБро▒рпИ 1: роТро░рпБ родрпЗроирпАро░рпН рокрпИропрпИропрпБроорпН роТро░рпБ роХрокрпНрокрпИропрпБроорпН роОроЯрпБродрпНродрпБроХрпН роХрпЖро╛ро│рпНро│рпБроЩрпНроХро│рпН.
           тАв ро╡роХрпИ: роОро│ро┐роп ро╡ро┤ро┐роорпБро▒рпИ
           роХро╛ро▓роорпН: 30 ро╡ро┐ройро╛роЯро┐роХро│рпН
        2. ро╡ро┤ро┐роорпБро▒рпИ 2: родрпЗроирпАро░рпН родропро╛ро░ро┐роХрпНроХрпБроорпН роирпЗро╛роХрпНроХродрпНродрпБроЯройрпН родрогрпНрогрпАро░рпИ роХрпЖро╛родро┐роХрпНроХ ро╡рпИроХрпНроХро╡рпБроорпН.
           тАв ро╡роХрпИ: роирпЗро╛роХрпНроХроорпН роХрпЖро╛рогрпНроЯ ро╡ро┤ро┐роорпБро▒рпИ
           роХро╛ро▓роорпН: 2 роиро┐рооро┐роЯроЩрпНроХро│рпН
        3. ро╡ро┤ро┐роорпБро▒рпИ 3: роХрпЖро╛родро┐роХрпНроХрпБроорпН родрогрпНрогрпАро░рпИ родрпЗроирпАро░рпН рокрпИропрпБроЯройрпН роХрокрпНрокро┐ро▓рпН роКро▒рпНро▒ро╡рпБроорпН.
           тАв ро╡роХрпИ: ро╡ро░ро┐роЪрпИ роХрпЖро╛рогрпНроЯ ро╡ро┤ро┐роорпБро▒рпИ
           роХро╛ро▓роорпН: 30 ро╡ро┐ройро╛роЯро┐роХро│рпН
        4. ро╡ро┤ро┐роорпБро▒рпИ 4: ро╡ро┐ро░рпБрокрпНрокрооро╛роХ, родрпЗроирпАро░ро┐ро▓рпН роЪро░рпНроХрпНроХро░рпИ роЕро▓рпНро▓родрпБ рокро╛ро▓рпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН.
           тАв ро╡роХрпИ: ро╡ро┐ро░рпБрокрпНрок ро╡ро┤ро┐роорпБро▒рпИ
           роХро╛ро▓роорпН: 1 роиро┐рооро┐роЯроорпН (ро╡ро┐ро░рпБрокрпНрокрооро╛ройродрпБ)
        5. ро╡ро┤ро┐роорпБро▒рпИ 5: рокро┐ройрпНройро░рпН, родрпЗроирпАро░рпИ рокро░ро┐рооро╛ро▒ро╡рпБроорпН.
           тАв ро╡роХрпИ: ро╡ро░ро┐роЪрпИ роХрпЖро╛рогрпНроЯ ро╡ро┤ро┐роорпБро▒рпИ
           роХро╛ро▓роорпН: 30 ро╡ро┐ройро╛роЯро┐роХро│рпН
        роорпЖро╛родрпНрод роирпЗро░ роХрогроХрпНроХрпАроЯрпБ:
           тАв роЪро░рпНроХрпНроХро░рпИ роЕро▓рпНро▓родрпБ рокро╛ро▓рпН роЪрпЗро░рпНродрпНродро▓рпН роЗро▓рпНро▓ро╛рооро▓рпН: 3 роиро┐рооро┐роЯроЩрпНроХро│рпН 30 ро╡ро┐ройро╛роЯро┐роХро│рпН
           тАв роЪро░рпНроХрпНроХро░рпИ роЕро▓рпНро▓родрпБ рокро╛ро▓рпН роЪрпЗро░рпНродрпНродро╛ро▓рпН: 4 роиро┐рооро┐роЯроЩрпНроХро│рпН 30 ро╡ро┐ройро╛роЯро┐роХро│рпН

        роЗрокрпНрокрпЗро╛родрпБ, *{recipe_name}*роХрпНроХро╛рой рокроЯро┐рокрпНрокроЯро┐ропро╛рой ро╡ро┤ро┐роорпБро▒рпИроХро│рпИ роорпЗро▓рпЗ роЙро│рпНро│ роХроЯрпНроЯроорпИрокрпНрокрпИрокрпН рокро┐ройрпНрокро▒рпНро▒ро┐ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН.
        """
    elif language_option == "Franc╠зais":
        prompt_template = f"""
        Vous e╠Вtes un chef professionnel et assistant culinaire. Votre ta╠Вche consiste a╠А fournir un guide de recette structure╠Б, e╠Бtape par e╠Бtape, avec des instructions claires, des e╠Бtapes cate╠Бgorise╠Бes et des dure╠Бes estime╠Бes.

        Nom de la recette: {recipe_name}

        Ta╠Вche D'ENTRE╠БE: Pre╠Бparer une tasse de the╠Б
        RE╠БSULTAT: Se╠Бquence d'instructions:
        
        1. Instruction 1: Prenez un sachet de the╠Б et une tasse.
           тАв Type: INSTRUCTION SIMPLE
           Dure╠Бe: 30 secondes
        2. Instruction 2: Faites bouillir de l'eau avec l'intention de faire du the╠Б.
           тАв Type: INSTRUCTION AVEC OBJECTIF
           Dure╠Бe: 2 minutes
        3. Instruction 3: Versez l'eau bouillie dans la tasse avec le sachet de the╠Б.
           тАв Type: INSTRUCTION AVEC SE╠БQUENCE
           Dure╠Бe: 30 secondes
        4. Instruction 4: Optionnellement, ajoutez du sucre ou du lait au the╠Б.
           тАв Type: INSTRUCTION EXCLUSIVE
           Dure╠Бe: 1 minute (facultatif)
        5. Instruction 5: Ensuite, servez le the╠Б.
           тАв Type: INSTRUCTION AVEC SE╠БQUENCE
           Dure╠Бe: 30 secondes
        Calcul du temps total:
           тАв Sans ajouter de sucre ou de lait: 3 minutes 30 secondes
           тАв Avec ajout de sucre ou de lait: 4 minutes 30 secondes

        Maintenant, ge╠Бne╠Бrez les instructions e╠Бtape par e╠Бtape pour {recipe_name} en suivant le format structure╠Б ci-dessus.
        """
    elif language_option == "р┤ор┤▓р┤пр┤╛р┤│р┤В":
        prompt_template = f"""
        р┤ир┤┐р┤Щр╡Нр┤Щр╡╛ р┤Тр┤░р╡Б р┤кр╡Нр┤░р╡Жр┤╛р┤лр┤╖р┤гр╡╜ р┤╖р╡Жр┤лр╡Н р┤Жр┤пр╡Бр┤В р┤кр┤╛р┤Ър┤Х р┤╕р┤╣р┤╛р┤пр┤┐р┤пр╡Бр┤ор┤╛р┤пр┤╛р┤гр╡Н р┤кр╡Нр┤░р┤╡р╡╝р┤др╡Нр┤др┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир┤др╡Н. р┤ир┤┐р┤Щр╡Нр┤Щр┤│р╡Бр┤Яр╡Ж р┤жр╡Чр┤др╡Нр┤пр┤ор┤╛р┤гр╡Н, р┤╡р╡Нр┤пр┤Хр╡Нр┤др┤ор┤╛р┤п р┤ир┤┐р╡╝р┤жр╡Нр┤жр╡Зр┤╢р┤Щр╡Нр┤Щр╡╛, р┤╡р┤┐р┤нр┤╛р┤Чр╡Ар┤Хр┤░р┤┐р┤Ър╡Нр┤Ъ р┤Шр┤Яр╡Нр┤Яр┤Щр╡Нр┤Щр╡╛, р┤╕р┤ор┤пр┤Хр╡Нр┤░р┤ор╡Ар┤Хр┤░р┤гр┤Щр╡Нр┤Щр╡╛ р┤Ор┤ир╡Нр┤ир┤┐р┤╡р┤пр╡Зр┤╛р┤Яр╡Жр┤пр╡Бр┤│р╡Нр┤│ р┤Тр┤░р╡Б р┤Хр╡Нр┤░р┤ор╡Ар┤Хр┤░р┤┐р┤Ър╡Нр┤Ъ р┤кр┤╛р┤Ър┤Х р┤ор┤╛р╡╝р┤Чр┤░р╡Зр┤Ц р┤ир╡╜р┤Хр╡Бр┤Х.

        р┤▒р╡Жр┤╕р┤┐р┤кр╡Нр┤кр┤┐ р┤кр╡Зр┤░р╡Н: {recipe_name}

        р┤Зр╡╗р┤кр╡Бр┤Яр╡Нр┤Яр╡Н р┤жр╡Чр┤др╡Нр┤пр┤В: р┤Тр┤░р╡Б р┤Хр┤кр╡Нр┤кр╡Н р┤Ър┤╛р┤п р┤Тр┤░р╡Бр┤Хр╡Нр┤Хр╡Бр┤Х
        р┤Фр┤Яр╡Нр┤Яр╡Нр┤кр╡Бр┤Яр╡Нр┤Яр╡Н: р┤Шр┤Яр╡Нр┤Яр┤Щр╡Нр┤Щр┤│р┤┐р┤▓р╡Ж р┤ир┤┐р╡╝р┤жр╡Нр┤жр╡Зр┤╢р┤Щр╡Нр┤Щр┤│р╡Бр┤Яр╡Ж р┤Хр╡Нр┤░р┤ор┤В:
        
        1. р┤Шр┤Яр╡Нр┤Яр┤В 1: р┤Тр┤░р╡Б р┤Яр╡А р┤мр┤╛р┤Чр╡Бр┤В р┤Тр┤░р╡Б р┤Хр┤кр╡Нр┤кр╡Бр┤В р┤Ор┤Яр╡Бр┤Хр╡Нр┤Хр╡Бр┤Х.
           тАв р┤др┤░р┤В: р┤▓р┤│р┤┐р┤д р┤ир┤┐р╡╝р┤жр╡Нр┤жр╡Зр┤╢р┤В
           р┤жр╡Ир╡╝р┤Шр╡Нр┤пр┤В: 30 р┤╕р╡Жр┤Хр╡Нр┤Хр╡╗р┤бр╡Н
        2. р┤Шр┤Яр╡Нр┤Яр┤В 2: р┤Ър┤╛р┤п р┤Йр┤гр╡Нр┤Яр┤╛р┤Хр╡Нр┤Хр┤╛р╡╗ р┤Йр┤жр╡Нр┤жр╡Зр┤╢р┤др╡Нр┤др╡Зр┤╛р┤Яр╡Ж р┤╡р╡Жр┤│р╡Нр┤│р┤В р┤Хр╡Бр┤др┤┐р┤░р┤┐р┤Хр╡Нр┤Хр╡Бр┤Х.
           тАв р┤др┤░р┤В: р┤▓р┤Хр╡Нр┤╖р╡Нр┤п р┤╕р┤╣р┤┐р┤др┤В р┤ир┤┐р╡╝р┤жр╡Нр┤жр╡Зр┤╢р┤В
           р┤жр╡Ир╡╝р┤Шр╡Нр┤пр┤В: 2 р┤ор┤┐р┤ир┤┐р┤▒р╡Нр┤▒р╡Н
        3. р┤Шр┤Яр╡Нр┤Яр┤В 3: р┤Ър╡Вр┤Яр┤╛р┤Хр╡Нр┤Хр┤┐р┤п р┤╡р╡Жр┤│р╡Нр┤│р┤В, р┤Яр┤┐ р┤мр┤╛р┤Чр╡Бр┤│р╡Нр┤│ р┤Хр┤кр╡Нр┤кр┤┐р┤▓р╡Зр┤Хр╡Нр┤Хр╡Н р┤Тр┤┤р┤┐р┤Хр╡Нр┤Хр╡Бр┤Х.
           тАв р┤др┤░р┤В: р┤Хр╡Нр┤░р┤о р┤ир┤┐р╡╝р┤жр╡Нр┤жр╡Зр┤╢р┤В
           р┤жр╡Ир╡╝р┤Шр╡Нр┤пр┤В: 30 р┤╕р╡Жр┤Хр╡Нр┤Хр╡╗р┤бр╡Н
        4. р┤Шр┤Яр╡Нр┤Яр┤В 4: р┤Рр┤Ър╡Нр┤Ыр┤┐р┤Хр┤ор┤╛р┤пр┤┐, р┤Ър┤╛р┤пр┤пр┤┐р╡╜ р┤кр┤Юр╡Нр┤Ър┤╕р┤╛р┤░р┤пр╡Зр┤╛ р┤кр┤╛р┤▓р┤┐р┤ир╡Зр┤╛ р┤Ър╡Зр╡╝р┤Хр╡Нр┤Хр╡Бр┤Х.
           тАв р┤др┤░р┤В: р┤Рр┤Ър╡Нр┤Ыр┤┐р┤Х р┤ир┤┐р╡╝р┤жр╡Нр┤жр╡Зр┤╢р┤В
           р┤жр╡Ир╡╝р┤Шр╡Нр┤пр┤В: 1 р┤ор┤┐р┤ир┤┐р┤▒р╡Нр┤▒р╡Н
        5. р┤Шр┤Яр╡Нр┤Яр┤В 5: р┤╢р╡Зр┤╖р┤В, р┤Ър┤╛р┤п р┤кр┤░р┤┐р┤╡р┤╣р┤┐р┤Хр╡Нр┤Хр╡Бр┤Х.
           тАв р┤др┤░р┤В: р┤Хр╡Нр┤░р┤о р┤ир┤┐р╡╝р┤жр╡Нр┤жр╡Зр┤╢р┤В
           р┤жр╡Ир╡╝р┤Шр╡Нр┤пр┤В: 30 р┤╕р╡Жр┤Хр╡Нр┤Хр╡╗р┤бр╡Н
        р┤ор╡Жр┤╛р┤др╡Нр┤др┤В р┤╕р┤ор┤пр┤В:
           тАв р┤кр┤Юр╡Нр┤Ър┤╕р┤╛р┤░/р┤кр┤╛р┤▓р┤┐р┤▓р╡Нр┤▓р┤╛р┤др╡Ж: 3 р┤ор┤┐р┤ир┤┐р┤▒р╡Нр┤▒р╡Н 30 р┤╕р╡Жр┤Хр╡Нр┤Хр╡╗р┤бр╡Н
           тАв р┤кр┤Юр╡Нр┤Ър┤╕р┤╛р┤░/р┤кр┤╛р┤▓р╡Зр┤╛р┤Яр╡Бр┤Хр╡Вр┤Яр┤┐: 4 р┤ор┤┐р┤ир┤┐р┤▒р╡Нр┤▒р╡Н 30 р┤╕р╡Жр┤Хр╡Нр┤Хр╡╗р┤бр╡Н

        р┤Зр┤ир┤┐, {recipe_name} р┤Ор┤ир╡Нр┤ир┤др┤┐р┤ир╡Бр┤др╡Нр┤др┤░р┤В р┤Хр╡Нр┤░р┤ор╡Ар┤Хр┤░р┤┐р┤Ър╡Нр┤Ъ р┤кр┤╛р┤Ър┤Х р┤ор┤╛р╡╝р┤Чр┤░р╡Зр┤Ц р┤др┤пр╡Нр┤пр┤╛р┤▒р┤╛р┤Хр╡Нр┤Хр╡Бр┤Х.
        """
    elif language_option == "р░др▒Жр░▓р▒Бр░Чр▒Б":
        prompt_template = f"""
        р░ор▒Ар░░р▒Б р░Тр░Х р░кр▒Нр░░р▒Кр░лр▒Жр░╖р░ир░▓р▒Н р░Ър▒Жр░лр▒Н р░ор░░р░┐р░пр▒Б р░╡р░Вр░Я р░╕р░╣р░╛р░пр░Хр▒Бр░бр░┐р░Чр░╛ р░╡р▒Нр░пр░╡р░╣р░░р░┐р░╕р▒Нр░др▒Бр░ир▒Нр░ир░╛р░░р▒Б. р░ор▒А р░кр░ир░┐, р░╕р▒Нр░кр░╖р▒Нр░Яр░ор▒Жр▒Цр░и р░╕р▒Вр░Ър░ир░▓р░др▒Л, р░╡р░┐р░нр░╛р░Чр░╛р░▓р▒Бр░Чр░╛ р░╡р░░р▒Нр░Чр▒Ар░Хр░░р░┐р░Вр░Ър░┐р░и р░жр░╢р░▓р░др▒Л р░ор░░р░┐р░пр▒Б р░Чр░гр░┐р░Вр░Ър░мр░бр░┐р░и р░╕р░ор░пр░╛р░▓р░др▒Л р░╕р░╣р░╛ р░Тр░Х р░╕р▒Бр░╕р░Вр░кр░ир▒Нр░ир░ор▒Жр▒Цр░и р░╡р░Вр░Яр░Хр░╛р░▓ р░Чр▒Жр▒Цр░бр▒НтАМр░ир░┐ р░Ер░Вр░жр░┐р░Вр░Ър░бр░В.

        р░╡р░Вр░Яр░Хр░кр▒Б р░кр▒Зр░░р▒Б: {recipe_name}

        р░Зр░ир▒Нр░кр▒Бр░Яр▒Н р░Яр░╛р░╕р▒Нр░Хр▒Н: р░Тр░Х р░Хр░кр▒Нр░кр▒Б р░Яр▒А р░ир▒Б р░др░пр░╛р░░р▒Бр░Ър▒Зр░пр░Вр░бр░┐
        р░Фр░Яр▒НтАМр░кр▒Бр░Яр▒Н: р░жр░╢р░▓р░╡р░╛р░░р▒А р░╕р▒Вр░Ър░ир░▓ р░╢р▒Нр░░р▒Зр░гр░┐:
        
        1. р░жр░╢ 1: р░Тр░Х р░Яр▒А р░мр▒Нр░пр░╛р░Чр▒Н р░ор░░р░┐р░пр▒Б р░Тр░Х р░Хр░кр▒Нр░кр▒Бр░ир▒Б р░др▒Ар░╕р▒Бр░Хр▒Лр░Вр░бр░┐.
           тАв р░др░░р░Чр░др░┐: р░╕р▒Бр░▓р░нр░ор▒Жр▒Цр░и р░╕р▒Вр░Ър░и
           р░╡р▒Нр░пр░╡р░зр░┐: 30 р░╕р▒Жр░Хр░ир▒Нр░▓р▒Б
        2. р░жр░╢ 2: р░Яр▒А р░др░пр░╛р░░р▒Бр░Ър▒Зр░пр░бр░╛р░ир░┐р░Хр░┐ р░ир▒Ар░Яр░┐р░ир░┐ р░ор░░р░┐р░Чр░┐р░Вр░Ър░Вр░бр░┐.
           тАв р░др░░р░Чр░др░┐: р░Йр░жр▒Нр░жр▒Зр░╢р▒Нр░пр░Вр░др▒Л р░Хр▒Вр░бр░┐р░и р░╕р▒Вр░Ър░и
           р░╡р▒Нр░пр░╡р░зр░┐: 2 р░ир░┐р░ор░┐р░╖р░╛р░▓р▒Б
        3. р░жр░╢ 3: р░ор░░р░┐р░Чр░┐р░и р░ир▒Ар░Яр░┐р░ир░┐ р░Яр▒А р░мр▒Нр░пр░╛р░Чр▒Н р░Йр░ир▒Нр░и р░Хр░кр▒Нр░кр▒Бр░▓р▒Л р░кр▒Лр░пр░Вр░бр░┐.
           тАв р░др░░р░Чр░др░┐: р░Ер░ир▒Бр░Хр▒Нр░░р░о р░╕р▒Вр░Ър░и
           р░╡р▒Нр░пр░╡р░зр░┐: 30 р░╕р▒Жр░Хр░ир▒Нр░▓р▒Б
        4. р░жр░╢ 4: р░Рр░Ър▒Нр░Ър░┐р░Хр░Вр░Чр░╛, р░Ър░Хр▒Нр░Хр▒Жр░░ р░▓р▒Зр░жр░╛ р░кр░╛р░▓р░ир▒Б р░Ьр▒Лр░бр░┐р░Вр░Ър░Вр░бр░┐.
           тАв р░др░░р░Чр░др░┐: р░Рр░Ър▒Нр░Ър░┐р░Х р░╕р▒Вр░Ър░и
           р░╡р▒Нр░пр░╡р░зр░┐: 1 р░ир░┐р░ор░┐р░╖р░В
        5. р░жр░╢ 5: р░др░░р▒Бр░╡р░╛р░д, р░Яр▒Ар░ир░┐ р░╕р░░р▒Нр░╡р▒Н р░Ър▒Зр░пр░Вр░бр░┐.
           тАв р░др░░р░Чр░др░┐: р░Ер░ир▒Бр░Хр▒Нр░░р░о р░╕р▒Вр░Ър░и
           р░╡р▒Нр░пр░╡р░зр░┐: 30 р░╕р▒Жр░Хр░ир▒Нр░▓р▒Б
        р░ор▒Кр░др▒Нр░др░В р░╕р░ор░пр░В:
           тАв р░Ър░Хр▒Нр░Хр▒Жр░░/р░кр░╛р░▓р▒Б р░▓р▒Зр░Хр▒Бр░Вр░бр░╛: 3 р░ир░┐р░ор░┐р░╖р░╛р░▓р▒Б 30 р░╕р▒Жр░Хр░ир▒Нр░▓р▒Б
           тАв р░Ър░Хр▒Нр░Хр▒Жр░░/р░кр░╛р░▓р▒Б р░Йр░Вр░Яр▒З: 4 р░ир░┐р░ор░┐р░╖р░╛р░▓р▒Б 30 р░╕р▒Жр░Хр░ир▒Нр░▓р▒Б

        р░Зр░кр▒Нр░кр▒Бр░бр▒Б, {recipe_name} р░Хр▒Лр░╕р░В р░кр▒Жр▒Ц р░ир░┐р░░р▒Нр░ор░┐р░д р░ир░ор▒Вр░ир░╛ р░кр▒Нр░░р░Хр░╛р░░р░В р░жр░╢р░▓р░╡р░╛р░░р▒А р░╕р▒Вр░Ър░ир░▓р░ир▒Б р░░р▒Вр░кр▒Кр░Вр░жр░┐р░Вр░Ър░Вр░бр░┐.
        """
    elif language_option == "р▓Хр▓ир│Нр▓ир▓б":
        prompt_template = f"""
        р▓ир▓┐р│Хр▓╡р│Жр│Вр▓Вр▓жр│Б р▓кр│Нр▓░р│Жр│Вр▓лр│Жр▓╖р▓ир▓▓р│Н р▓╢р│Жр▓лр│Н р▓ор▓др│Нр▓др│Б р▓Ер▓бр│Бр▓Чр│Ж р▓╕р▓╣р▓╛р▓пр▓Хр▓░р▓╛р▓Чр▓┐ р▓Хр▓╛р▓░р│Нр▓пр▓ир▓┐р▓░р│Нр▓╡р▓╣р▓┐р▓╕р│Бр▓др│Нр▓др▓┐р│Хр▓░р▓┐. р▓ир▓┐р▓ор│Нр▓о р▓Хр▓░р│Нр▓др▓╡р│Нр▓пр▓╡р│Жр▓Вр▓жр▓░р│Ж, р▓╕р│Нр▓кр▓╖р│Нр▓Я р▓╕р│Вр▓Ър▓ир│Жр▓Чр▓│р│Б, р▓╡р▓┐р▓нр▓╛р▓Чр▓┐р│Хр▓Хр▓░р▓┐р▓╕р▓┐р▓ж р▓╣р▓Вр▓др▓Чр▓│р│Б р▓ор▓др│Нр▓др│Б р▓Ер▓Вр▓жр▓╛р▓Ьр│Б р▓Хр▓╛р▓▓р▓╛р▓╡р▓зр▓┐р▓Чр▓│р│Жр│Вр▓Вр▓жр▓┐р▓Чр│Ж р▓кр▓░р▓┐р▓Ър▓пр▓┐р▓др▓╡р▓╛р▓ж р▓кр▓╛р▓Хр▓╡р▓┐р▓зр▓╛р▓и р▓ор▓╛р▓░р│Нр▓Чр▓жр▓░р│Нр▓╢р▓ир▓╡р▓ир│Нр▓ир│Б р▓Тр▓жр▓Чр▓┐р▓╕р│Бр▓╡р│Бр▓жр│Б.

        р▓░р│Жр▓╕р▓┐р▓кр▓┐р▓п р▓╣р│Жр▓╕р▓░р│Б: {recipe_name}

        р▓Зр▓ир│Нр▓кр│Бр▓Яр│Н р▓Хр│Жр▓▓р▓╕: р▓Тр▓Вр▓жр│Б р▓Хр▓кр│Н р▓Ър▓╣р▓╛ р▓др▓пр▓╛р▓░р▓┐р▓╕р▓┐
        р▓Фр▓Яр│НтАМр▓кр│Бр▓Яр│Н: р▓╣р▓Вр▓д р▓╣р▓Вр▓др▓ж р▓╕р│Вр▓Ър▓ир│Жр▓Чр▓│р│Б:
        
        1. р▓╣р▓Вр▓д 1: р▓Тр▓Вр▓жр│Б р▓Яр▓┐р│Хр▓╕р│Н р▓мр│Нр▓пр▓╛р▓Чр│Н р▓ор▓др│Нр▓др│Б р▓Тр▓Вр▓жр│Б р▓Хр▓кр│Н р▓Ер▓ир│Нр▓ир│Б р▓др│Жр▓Чр│Жр▓жр│Бр▓Хр│Жр│Вр▓│р│Нр▓│р▓┐.
           тАв р▓кр│Нр▓░р▓Хр▓╛р▓░: р▓╕р▓░р▓│ р▓╕р│Вр▓Ър▓ир│Ж
           р▓Ер▓╡р▓зр▓┐: 30 р▓╕р│Жр▓Хр│Жр▓Вр▓бр│Б
        2. р▓╣р▓Вр▓д 2: р▓Ър▓╣р▓╛ р▓ор▓╛р▓бр▓▓р│Б р▓ир▓┐р│Хр▓░р▓ир│Нр▓ир│Б р▓Хр│Бр▓жр▓┐р▓╕р▓┐.
           тАв р▓кр│Нр▓░р▓Хр▓╛р▓░: р▓Йр▓жр│Нр▓жр│Жр│Хр▓╢ р▓╕р│Вр▓Ър▓ир│Ж
           р▓Ер▓╡р▓зр▓┐: 2 р▓ир▓┐р▓ор▓┐р▓╖
        3. р▓╣р▓Вр▓д 3: р▓Хр│Бр▓жр▓┐р▓ж р▓ир▓┐р│Хр▓░р▓ир│Нр▓ир│Б р▓Яр▓┐р│Хр▓╕р│Н р▓мр│Нр▓пр▓╛р▓Чр│Н р▓Зр▓░р│Бр▓╡ р▓Хр▓кр│НтАМр▓Чр│Ж р▓╣р▓╛р▓Хр▓┐.
           тАв р▓кр│Нр▓░р▓Хр▓╛р▓░: р▓Хр│Нр▓░р▓о р▓╕р│Вр▓Ър▓ир│Ж
           р▓Ер▓╡р▓зр▓┐: 30 р▓╕р│Жр▓Хр│Жр▓Вр▓бр│Б
        4. р▓╣р▓Вр▓д 4: р▓Жр▓пр│Нр▓Хр│Жр▓пр▓Вр▓др│Ж, р▓Ър▓╣р│Жр▓Чр│Ж р▓╕р▓Хр│Нр▓Хр▓░р│Ж р▓Ер▓ер▓╡р▓╛ р▓╣р▓╛р▓▓р│Б р▓╕р│Жр│Хр▓░р▓┐р▓╕р▓┐.
           тАв р▓кр│Нр▓░р▓Хр▓╛р▓░: р▓Рр▓Ър│Нр▓Ыр▓┐р▓Х р▓╕р│Вр▓Ър▓ир│Ж
           р▓Ер▓╡р▓зр▓┐: 1 р▓ир▓┐р▓ор▓┐р▓╖
        5. р▓╣р▓Вр▓д 5: р▓ир▓Вр▓др▓░, р▓Ър▓╣р▓╛р▓╡р▓ир│Нр▓ир│Б р▓╕р▓░р│Нр▓╡р│Н р▓ор▓╛р▓бр▓┐.
           тАв р▓кр│Нр▓░р▓Хр▓╛р▓░: р▓Хр│Нр▓░р▓о р▓╕р│Вр▓Ър▓ир│Ж
           р▓Ер▓╡р▓зр▓┐: 30 р▓╕р│Жр▓Хр│Жр▓Вр▓бр│Б
        р▓Тр▓Яр│Нр▓Яр│Б р▓╕р▓ор▓п р▓▓р│Жр▓Хр│Нр▓Х:
           тАв р▓╕р▓Хр│Нр▓Хр▓░р│Ж/р▓╣р▓╛р▓▓р▓┐р▓▓р│Нр▓▓р▓жр│Ж: 3 р▓ир▓┐р▓ор▓┐р▓╖ 30 р▓╕р│Жр▓Хр│Жр▓Вр▓бр│Б
           тАв р▓╕р▓Хр│Нр▓Хр▓░р│Ж/р▓╣р▓╛р▓▓р│Б р▓╕р│Жр│Хр▓░р▓┐р▓╕р▓┐р▓жр▓░р│Ж: 4 р▓ир▓┐р▓ор▓┐р▓╖ 30 р▓╕р│Жр▓Хр│Жр▓Вр▓бр│Б

        р▓Ир▓Ч, {recipe_name} р▓Чр│Ж р▓╕р▓Вр▓мр▓Вр▓зр▓┐р▓╕р▓┐р▓ж р▓╣р▓Вр▓д р▓╣р▓Вр▓др▓ж р▓кр▓╛р▓Хр▓╡р▓┐р▓зр▓╛р▓и р▓╕р│Вр▓Ър▓ир│Жр▓Чр▓│р▓ир│Нр▓ир│Б р▓░р▓Ър▓┐р▓╕р▓┐.
        """
    elif language_option == "рд╣рд┐рдиреНрджреА":
        prompt_template = f"""
        рдЖрдк рдПрдХ рдкреЗрд╢реЗрд╡рд░ рд╢реЗрдл рдФрд░ рдХреБрдХрд┐рдВрдЧ рдЕрд╕рд┐рд╕реНрдЯреЗрдВрдЯ рд╣реИрдВред рдЖрдкрдХрд╛ рдХрд╛рд░реНрдп рд╕реНрдкрд╖реНрдЯ рдирд┐рд░реНрджреЗрд╢реЛрдВ, рдХреНрд░рдордмрджреНрдз рдЪрд░рдгреЛрдВ рдФрд░ рдЕрдиреБрдорд╛рдирд┐рдд рд╕рдордп рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдВрд░рдЪрд┐рдд рд░реЗрд╕рд┐рдкреА рдЧрд╛рдЗрдб рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рд╣реИред

        рд░реЗрд╕рд┐рдкреА рдХрд╛ рдирд╛рдо: {recipe_name}

        рдЗрдирдкреБрдЯ рдХрд╛рд░реНрдп: рдПрдХ рдХрдк рдЪрд╛рдп рддреИрдпрд╛рд░ рдХрд░реЗрдВ
        рдЖрдЙрдЯрдкреБрдЯ: рдЪрд░рдг-рджрд░-рдЪрд░рдг рдирд┐рд░реНрджреЗрд╢:
        
        1. рдЪрд░рдг 1: рдПрдХ рдЯреА рдмреИрдЧ рдФрд░ рдПрдХ рдХрдк рд▓реЗрдВред
           тАв рдкреНрд░рдХрд╛рд░: рд╕рд╛рдзрд╛рд░рдг рдирд┐рд░реНрджреЗрд╢
           рдЕрд╡рдзрд┐: 30 рд╕реЗрдХрдВрдб
        2. рдЪрд░рдг 2: рдЪрд╛рдп рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛рдиреА рдХреЛ рдЙрдмрд╛рд▓реЗрдВред
           тАв рдкреНрд░рдХрд╛рд░: рдЙрджреНрджреЗрд╢реНрдп рдирд┐рд░реНрджреЗрд╢
           рдЕрд╡рдзрд┐: 2 рдорд┐рдирдЯ
        3. рдЪрд░рдг 3: рдЙрдмрд▓реЗ рд╣реБрдП рдкрд╛рдиреА рдХреЛ рдЯреА рдмреИрдЧ рд╡рд╛рд▓реЗ рдХрдк рдореЗрдВ рдбрд╛рд▓реЗрдВред
           тАв рдкреНрд░рдХрд╛рд░: рдХреНрд░рдо рдирд┐рд░реНрджреЗрд╢
           рдЕрд╡рдзрд┐: 30 рд╕реЗрдХрдВрдб
        4. рдЪрд░рдг 4: рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ, рдЪрд╛рдп рдореЗрдВ рдЪреАрдиреА рдпрд╛ рджреВрдз рдорд┐рд▓рд╛рдПрдВред
           тАв рдкреНрд░рдХрд╛рд░: рд╡реИрдХрд▓реНрдкрд┐рдХ рдирд┐рд░реНрджреЗрд╢
           рдЕрд╡рдзрд┐: 1 рдорд┐рдирдЯ
        5. рдЪрд░рдг 5: рдлрд┐рд░, рдЪрд╛рдп рдкрд░реЛрд╕реЗрдВред
           тАв рдкреНрд░рдХрд╛рд░: рдХреНрд░рдо рдирд┐рд░реНрджреЗрд╢
           рдЕрд╡рдзрд┐: 30 рд╕реЗрдХрдВрдб
        рдХреБрд▓ рд╕рдордп:
           тАв рдмрд┐рдирд╛ рдЪреАрдиреА/рджреВрдз рдХреЗ: 3 рдорд┐рдирдЯ 30 рд╕реЗрдХрдВрдб
           тАв рдЪреАрдиреА/рджреВрдз рдХреЗ рд╕рд╛рде: 4 рдорд┐рдирдЯ 30 рд╕реЗрдХрдВрдб

        рдЕрдм, {recipe_name} рдХреЗ рд▓рд┐рдП рдКрдкрд░ рджрд┐рдП рдЧрдП рд╕рдВрд░рдЪрд┐рдд рдкреНрд░рд╛рд░реВрдк рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреЗ рд╣реБрдП рдЪрд░рдг-рджрд░-рдЪрд░рдг рдирд┐рд░реНрджреЗрд╢ рддреИрдпрд╛рд░ рдХрд░реЗрдВред
        """
    else:
        prompt_template = f"""
        You are a professional chef and cooking assistant. Your task is to provide a structured, step-by-step recipe guide with clear instructions, categorized steps, and estimated durations.

        Recipe Name: {recipe_name}

        INPUT Task: Prepare a Cup of Tea
        OUTPUT: Sequence of Instructions:
        
        1. Instruction 1: Take a tea bag and a cup.
           тАв Type: SIMPLE INSTRUCTION
           Duration: 30 seconds
        2. Instruction 2: Boil water with the intention of making tea.
           тАв Type: INSTRUCTION WITH PURPOSE
           Duration: 2 minutes
        3. Instruction 3: Pour the boiled water into the cup with the tea bag.
           тАв Type: INSTRUCTION WITH SEQUENCE
           Duration: 30 seconds
        4. Instruction 4: Optionally, add sugar or milk to the tea.
           Type: EXCLUSIVE INSTRUCTION
           Duration: 1 minute (optional)
        5. Instruction 5: Then, serve the tea.
           тАв Type: INSTRUCTION WITH SEQUENCE
           Duration: 30 seconds
        Total Time Calculation:
           тАв Without adding sugar or milk: 3 minutes 30 seconds
           тАв With adding sugar or milk: 4 minutes 30 seconds

        Now, generate the step-by-step instructions for {recipe_name} following the above structured format.
        """
    chat_completion = client.chat.completions.create(
        messages=[
            {"role": "system", "content": "You are a professional chef and cooking assistant."},
            {"role": "user", "content": prompt_template}
        ],
        model="llama-3.3-70b-versatile",
    )
    return chat_completion.choices[0].message.content

def speech_to_text():
    recognizer = sr.Recognizer()
    with sr.Microphone() as source:
        if language_option == "English":
            st.write("ЁЯОд Speak the recipe name...")
            recog_lang = "en-US"
        elif language_option == "родрооро┐ро┤рпН":
            st.write("ЁЯОд роЪрпЖропрпНроорпБро▒рпИ рокрпЖропро░рпИрокрпН рокрпЗроЪрпБроЩрпНроХро│рпН...")
            recog_lang = "ta-IN"
        elif language_option == "Franc╠зais":
            st.write("ЁЯОд Dites le nom de la recette...")
            recog_lang = "fr-FR"
        elif language_option == "р┤ор┤▓р┤пр┤╛р┤│р┤В":
            st.write("ЁЯОд р┤▒р╡Жр┤╕р┤┐р┤кр╡Нр┤кр┤┐р┤пр╡Бр┤Яр╡Ж р┤кр╡Зр┤░р╡Н р┤кр┤▒р┤Юр╡Нр┤Юр╡Бр┤Х...")
            recog_lang = "ml-IN"
        elif language_option == "р░др▒Жр░▓р▒Бр░Чр▒Б":
            st.write("ЁЯОд р░╡р░Вр░Яр░Хр░В р░кр▒Зр░░р▒Бр░ир▒Б р░кр░▓р░┐р░Хр░Вр░бр░┐...")
            recog_lang = "te-IN"
        elif language_option == "р▓Хр▓ир│Нр▓ир▓б":
            st.write("ЁЯОд р▓░р│Жр▓╕р▓┐р▓кр▓┐р▓п р▓╣р│Жр▓╕р▓░р▓ир│Нр▓ир│Б р▓╣р│Жр│Хр▓│р▓┐...")
            recog_lang = "kn-IN"
        elif language_option == "рд╣рд┐рдиреНрджреА":
            st.write("ЁЯОд рд░реЗрд╕рд┐рдкреА рдХрд╛ рдирд╛рдо рдмреЛрд▓реЗрдВ...")
            recog_lang = "hi-IN"
        else:
            st.write("ЁЯОд Speak the recipe name...")
            recog_lang = "en-US"
        recognizer.adjust_for_ambient_noise(source)
        try:
            audio = recognizer.listen(source, timeout=5)
            text = recognizer.recognize_google(audio, language=recog_lang)
            return text
        except sr.UnknownValueError:
            if language_option == "English":
                st.write("тЭМ Sorry, I couldn't understand the speech.")
            elif language_option == "родрооро┐ро┤рпН":
                st.write("тЭМ рооройрпНройро┐роХрпНроХро╡рпБроорпН, роиро╛ройрпН рокрпЗроЪрпНроЪрпИрокрпН рокрпБро░ро┐роирпНродрпБ роХрпЖро╛ро│рпНро│ро╡ро┐ро▓рпНро▓рпИ.")
            elif language_option == "Franc╠зais":
                st.write("тЭМ De╠Бsole╠Б, je n'ai pas compris le discours.")
            elif language_option == "р┤ор┤▓р┤пр┤╛р┤│р┤В":
                st.write("тЭМ р┤Хр╡Нр┤╖р┤ор┤┐р┤Хр╡Нр┤Хр┤гр┤В, р┤Юр┤╛р╡╗ р┤╕р┤Вр┤╕р┤╛р┤░р┤др╡Нр┤др╡Ж р┤ор┤ир┤╕р┤┐р┤▓р┤╛р┤Хр╡Нр┤Хр┤╛р┤ир┤╛р┤пр┤┐р┤▓р╡Нр┤▓.")
            elif language_option == "р░др▒Жр░▓р▒Бр░Чр▒Б":
                st.write("тЭМ р░Хр▒Нр░╖р░ор░┐р░Вр░Ър░Вр░бр░┐, р░ир▒Зр░ир▒Б р░ор░╛р░Яр░▓р▒Б р░др▒Жр░▓р▒Бр░╕р▒Бр░Хр▒Лр░▓р▒Зр░Хр░кр▒Лр░пр░╛р░ир▒Б.")
            elif language_option == "р▓Хр▓ир│Нр▓ир▓б":
                st.write("тЭМ р▓Хр│Нр▓╖р▓ор▓┐р▓╕р▓┐, р▓ир▓╛р▓ир│Б р▓ор▓╛р▓др▓ир│Нр▓ир│Б р▓Ер▓░р│Нр▓ер▓ор▓╛р▓бр▓┐р▓Хр│Жр│Вр▓│р│Нр▓│р▓▓р▓┐р▓▓р│Нр▓▓.")
            elif language_option == "рд╣рд┐рдиреНрджреА":
                st.write("тЭМ рдХреНрд╖рдорд╛ рдХрд░реЗрдВ, рдореИрдВ рдмреЛрд▓рдЪрд╛рд▓ рд╕рдордЭ рдирд╣реАрдВ рдкрд╛рдпрд╛ред")
            return None
        except sr.RequestError:
            if language_option == "English":
                st.write("тЭМ Could not request results, check your internet connection.")
            elif language_option == "родрооро┐ро┤рпН":
                st.write("тЭМ роорпБроЯро┐ро╡рпБроХро│рпИроХрпН роХрпЗро╛ро░ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ, роЙроЩрпНроХро│рпН роЗрогрпИроп роЗрогрпИрокрпНрокрпИроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН.")
            elif language_option == "Franc╠зais":
                st.write("тЭМ Impossible de demander les re╠Бsultats, ve╠Бrifiez votre connexion Internet.")
            elif language_option == "р┤ор┤▓р┤пр┤╛р┤│р┤В":
                st.write("тЭМ р┤лр┤▓р┤Щр╡Нр┤Щр╡╛ р┤▓р┤нр┤┐р┤Ър╡Нр┤Ър┤┐р┤▓р╡Нр┤▓, р┤жр┤пр┤╡р┤╛р┤пр┤┐ р┤Зр┤ир╡Нр┤▒р╡╝р┤ир╡Жр┤▒р╡Нр┤▒р╡Н р┤мр┤ир╡Нр┤зр┤В р┤кр┤░р┤┐р┤╢р╡Зр┤╛р┤зр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х.")
            elif language_option == "р░др▒Жр░▓р▒Бр░Чр▒Б":
                st.write("тЭМ р░лр░▓р░┐р░др░╛р░▓р░ир▒Б р░Хр▒Лр░░р░бр░В р░╕р░╛р░зр▒Нр░пр░кр░бр░▓р▒Зр░жр▒Б, р░жр░пр░Ър▒Зр░╕р░┐ р░ор▒А р░Зр░Вр░Яр░░р▒Нр░ир▒Жр░Яр▒Н р░Хр░ир▒Жр░Хр▒Нр░╖р░ир▒Н р░др░ир░┐р░Цр▒А р░Ър▒Зр░пр░Вр░бр░┐.")
            elif language_option == "р▓Хр▓ир│Нр▓ир▓б":
                st.write("тЭМ р▓лр▓▓р▓┐р▓др▓╛р▓Вр▓╢р▓Чр▓│р▓ир│Нр▓ир│Б р▓Хр│Жр│Хр▓│р▓▓р│Б р▓╕р▓╛р▓зр│Нр▓пр▓╡р▓╛р▓Чр▓▓р▓┐р▓▓р│Нр▓▓, р▓жр▓пр▓╡р▓┐р▓Яр│Нр▓Яр│Б р▓ир▓┐р▓ор│Нр▓о р▓Зр▓Вр▓Яр▓░р│Нр▓ир│Жр▓Яр│Н р▓╕р▓Вр▓кр▓░р│Нр▓Хр▓╡р▓ир│Нр▓ир│Б р▓кр▓░р▓┐р▓╢р▓┐р│Хр▓▓р▓┐р▓╕р▓┐.")
            elif language_option == "рд╣рд┐рдиреНрджреА":
                st.write("тЭМ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХрд╛ рдЕрдиреБрд░реЛрдз рдирд╣реАрдВ рдХрд░ рд╕рдХрд╛, рдХреГрдкрдпрд╛ рдЕрдкрдиреЗ рдЗрдВрдЯрд░рдиреЗрдЯ рдХрдиреЗрдХреНрд╢рди рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред")
            return None

# --- Streamlit UI Setup ---
if language_option == "English":
    title_text = "ЁЯН╜ Cooking Assistant - Get Your Recipes!"
    instruction_text = "Type the name of the recipe or use voice input to get step-by-step instructions."
elif language_option == "родрооро┐ро┤рпН":
    title_text = "ЁЯН╜ роЪроорпИропро▓рпН роЙродро╡ро┐ропро╛ро│ро░рпН - роЙроЩрпНроХро│рпН роЪрпЖропрпНроорпБро▒рпИроХро│рпИроХрпН рокрпЖро▒рпБроЩрпНроХро│рпН!"
    instruction_text = "роЪрпЖропрпНроорпБро▒рпИ рокрпЖропро░рпИ родроЯрпНроЯроЪрпНроЪрпБ роЪрпЖропрпНропро╡рпБроорпН роЕро▓рпНро▓родрпБ роХрпБро░ро▓рпН роЙро│рпНро│рпАроЯрпНроЯрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ рокроЯро┐рокрпНрокроЯро┐ропро╛рой ро╡ро┤ро┐роорпБро▒рпИроХро│рпИрокрпН рокрпЖро▒ро╡рпБроорпН."
elif language_option == "Franc╠зais":
    title_text = "ЁЯН╜ Assistant de Cuisine - Obtenez Vos Recettes!"
    instruction_text = "Tapez le nom de la recette ou utilisez l'entre╠Бe vocale pour obtenir des instructions e╠Бtape par e╠Бtape."
elif language_option == "р┤ор┤▓р┤пр┤╛р┤│р┤В":
    title_text = "ЁЯН╜ р┤╡р┤┐р┤нр┤Хр╡Нр┤╖р╡Нр┤п р┤╕р┤╣р┤╛р┤пр┤┐ - р┤ир┤┐р┤Щр╡Нр┤Щр┤│р╡Бр┤Яр╡Ж р┤▒р╡Жр┤╕р┤┐р┤кр╡Нр┤кр┤┐р┤Хр┤│р╡НтАН р┤▓р┤нр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х!"
    instruction_text = "р┤▒р╡Жр┤╕р┤┐р┤кр╡Нр┤кр┤┐р┤пр╡Бр┤Яр╡Ж р┤кр╡Зр┤░р╡Н р┤Яр╡Ир┤кр╡Нр┤кр╡Н р┤Ър╡Жр┤пр╡Нр┤пр╡Бр┤Х р┤Ер┤▓р╡Нр┤▓р╡Жр┤Щр╡Нр┤Хр┤┐р╡╜ р┤╡р╡Зр┤╛р┤пр╡Нр┤╕р╡Н р┤Зр╡╗р┤кр╡Бр┤Яр╡Нр┤Яр╡Н р┤Йр┤кр┤пр╡Зр┤╛р┤Чр┤┐р┤Ър╡Нр┤Ър╡Н р┤Шр┤Яр╡Нр┤Яр┤В р┤Шр┤Яр╡Нр┤Яр┤ор┤╛р┤пр┤┐ р┤ир┤┐р╡╝р┤жр╡Нр┤жр╡Зр┤╢р┤Щр╡Нр┤Щр╡╛ р┤ир╡Зр┤Яр╡Бр┤Х."
elif language_option == "р░др▒Жр░▓р▒Бр░Чр▒Б":
    title_text = "ЁЯН╜ р░╡р░Вр░Я р░╕р░╣р░╛р░пр░Хр▒Бр░бр▒Б - р░ор▒А р░╡р░Вр░Яр░Хр░╛р░▓р▒Б р░кр▒Кр░Вр░жр░Вр░бр░┐!"
    instruction_text = "р░╡р░Вр░Яр░Хр░В р░кр▒Зр░░р▒Бр░ир▒Б р░Яр▒Жр▒Цр░кр▒Н р░Ър▒Зр░пр░Вр░бр░┐ р░▓р▒Зр░жр░╛ р░╡р░╛р░пр░┐р░╕р▒Н р░Зр░ир▒Нр░кр▒Бр░Яр▒Н р░жр▒Нр░╡р░╛р░░р░╛ р░жр░╢р░▓ р░╡р░╛р░░р▒Ар░Чр░╛ р░╕р▒Вр░Ър░ир░▓р▒Б р░кр▒Кр░Вр░жр░Вр░бр░┐."
elif language_option == "р▓Хр▓ир│Нр▓ир▓б":
    title_text = "ЁЯН╜ р▓Ер▓бр│Бр▓Чр│Ж р▓╕р▓╣р▓╛р▓пр▓Х - р▓ир▓┐р▓ор│Нр▓о р▓кр▓╛р▓Хр▓╡р▓┐р▓зр▓╛р▓ир▓Чр▓│р▓ир│Нр▓ир│Б р▓кр▓бр│Жр▓пр▓┐р▓░р▓┐!"
    instruction_text = "р▓кр▓╛р▓Хр▓╡р▓┐р▓зр▓╛р▓ир▓ж р▓╣р│Жр▓╕р▓░р▓ир│Нр▓ир│Б р▓Яр│Жр│Цр▓кр│Н р▓ор▓╛р▓бр▓┐ р▓Ер▓ер▓╡р▓╛ р▓зр│Нр▓╡р▓ир▓┐ р▓Зр▓ир│Нр▓кр│Бр▓Яр│Н р▓мр▓│р▓╕р▓┐ р▓╣р▓Вр▓д р▓╣р▓Вр▓др▓ж р▓╕р│Вр▓Ър▓ир│Жр▓Чр▓│р▓ир│Нр▓ир│Б р▓кр▓бр│Жр▓пр▓┐р▓░р▓┐."
elif language_option == "рд╣рд┐рдиреНрджреА":
    title_text = "ЁЯН╜ рдЦрд╛рдирд╛ рд╕рд╣рд╛рдпрдХ - рдЕрдкрдиреА рд░реЗрд╕рд┐рдкреА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!"
    instruction_text = "рд░реЗрд╕рд┐рдкреА рдХрд╛ рдирд╛рдо рдЯрд╛рдЗрдк рдХрд░реЗрдВ рдпрд╛ рд╡реЙрдЗрд╕ рдЗрдирдкреБрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЪрд░рдг-рджрд░-рдЪрд░рдг рдирд┐рд░реНрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред"
else:
    title_text = "ЁЯН╜ Cooking Assistant"
    instruction_text = "Enter the recipe name or use voice input."

st.title(title_text)
st.write(instruction_text)

# Initialize session states for messages and recipe_name
if "messages" not in st.session_state:
    st.session_state.messages = []
if "recipe_name" not in st.session_state:
    st.session_state.recipe_name = ""

# Display chat history
for i, msg in enumerate(st.session_state.messages):
    if msg["role"] == "user":
        message(msg['content'], is_user=True, key=f'user_{i}', avatar_style="miniavs")
    else:
        message(msg['content'], is_user=False, key=f'assistant_{i}', avatar_style="icons")

# --- Voice Input Button ---
if language_option == "English":
    voice_button_label = "ЁЯОд Use Voice Input"
elif language_option == "родрооро┐ро┤рпН":
    voice_button_label = "ЁЯОд роХрпБро░ро▓рпН роЙро│рпНро│рпАроЯрпНроЯрпИрокрпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН"
elif language_option == "Franc╠зais":
    voice_button_label = "ЁЯОд Utiliser l'entre╠Бe vocale"
elif language_option == "р┤ор┤▓р┤пр┤╛р┤│р┤В":
    voice_button_label = "ЁЯОд р┤╡р╡Зр┤╛р┤пр╡Нр┤╕р╡Н р┤Зр╡╗р┤кр╡Бр┤Яр╡Нр┤Яр╡Н р┤Йр┤кр┤пр╡Зр┤╛р┤Чр┤┐р┤Хр╡Нр┤Хр╡Бр┤Х"
elif language_option == "р░др▒Жр░▓р▒Бр░Чр▒Б":
    voice_button_label = "ЁЯОд р░╡р░╛р░пр░┐р░╕р▒Н р░Зр░ир▒Нр░кр▒Бр░Яр▒Н р░Йр░кр░пр▒Лр░Чр░┐р░Вр░Ър░Вр░бр░┐"
elif language_option == "р▓Хр▓ир│Нр▓ир▓б":
    voice_button_label = "ЁЯОд р▓зр│Нр▓╡р▓ир▓┐ р▓Зр▓ир│Нр▓кр│Бр▓Яр│Н р▓мр▓│р▓╕р▓┐"
elif language_option == "рд╣рд┐рдиреНрджреА":
    voice_button_label = "ЁЯОд рд╡реЙрдЗрд╕ рдЗрдирдкреБрдЯ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ"
else:
    voice_button_label = "ЁЯОд Use Voice Input"

if st.button(voice_button_label):
    recipe_name_input = speech_to_text()
    if recipe_name_input:
        st.session_state.recipe_name = recipe_name_input
        st.session_state.messages.append({"role": "user", "content": recipe_name_input})
        if language_option == "English":
            st.write("Fetching the recipe...")
        elif language_option == "родрооро┐ро┤рпН":
            st.write("роЪрпЖропрпНроорпБро▒рпИ рокрпЖро▒рокрпНрокроЯрпБроХро┐ро▒родрпБ...")
        elif language_option == "Franc╠зais":
            st.write("Re╠Бcupe╠Бration de la recette...")
        elif language_option == "р┤ор┤▓р┤пр┤╛р┤│р┤В":
            st.write("р┤▒р╡Жр┤╕р┤┐р┤кр╡Нр┤кр┤┐ р┤▓р┤нр┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир╡Б...")
        elif language_option == "р░др▒Жр░▓р▒Бр░Чр▒Б":
            st.write("р░╡р░Вр░Яр░Хр░В р░кр▒Кр░Вр░жр▒Бр░др▒Бр░ир▒Нр░ир░╛р░В...")
        elif language_option == "р▓Хр▓ир│Нр▓ир▓б":
            st.write("р▓кр▓╛р▓Хр▓╡р▓┐р▓зр▓╛р▓ир▓╡р▓ир│Нр▓ир│Б р▓кр▓бр│Жр▓пр│Бр▓др│Нр▓др▓┐р▓жр│Ж...")
        elif language_option == "рд╣рд┐рдиреНрджреА":
            st.write("рд░реЗрд╕рд┐рдкреА рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд░рд╣реА рд╣реИ...")
        recipe_instructions = get_recipe(st.session_state.recipe_name)
        st.session_state.messages.append({"role": "assistant", "content": recipe_instructions})
        st.rerun()

# --- Text Input Field ---
if language_option == "English":
    text_input_label = "Enter Recipe Name:"
elif language_option == "родрооро┐ро┤рпН":
    text_input_label = "роЪрпЖропрпНроорпБро▒рпИ рокрпЖропро░рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН:"
elif language_option == "Franc╠зais":
    text_input_label = "Entrez le nom de la recette:"
elif language_option == "р┤ор┤▓р┤пр┤╛р┤│р┤В":
    text_input_label = "р┤▒р╡Жр┤╕р┤┐р┤кр╡Нр┤кр┤┐р┤пр╡Бр┤Яр╡Ж р┤кр╡Зр┤░р╡Н р┤ир╡╜р┤Хр╡Бр┤Х:"
elif language_option == "р░др▒Жр░▓р▒Бр░Чр▒Б":
    text_input_label = "р░╡р░Вр░Яр░Хр░В р░кр▒Зр░░р▒Бр░ир▒Б р░ир░ор▒Лр░жр▒Б р░Ър▒Зр░пр░Вр░бр░┐:"
elif language_option == "р▓Хр▓ир│Нр▓ир▓б":
    text_input_label = "р▓кр▓╛р▓Хр▓╡р▓┐р▓зр▓╛р▓ир▓ж р▓╣р│Жр▓╕р▓░р▓ир│Нр▓ир│Б р▓ир▓ор│Вр▓жр▓┐р▓╕р▓┐:"
elif language_option == "рд╣рд┐рдиреНрджреА":
    text_input_label = "рд░реЗрд╕рд┐рдкреА рдХрд╛ рдирд╛рдо рджрд░реНрдЬ рдХрд░реЗрдВ:"
else:
    text_input_label = "Enter Recipe Name:"

recipe_name_input = st.text_input(text_input_label, value=st.session_state.recipe_name)
if recipe_name_input and recipe_name_input != st.session_state.recipe_name:
    st.session_state.recipe_name = recipe_name_input
    st.session_state.messages.append({"role": "user", "content": recipe_name_input})
    if language_option == "English":
        st.write("Fetching the recipe...")
    elif language_option == "родрооро┐ро┤рпН":
        st.write("роЪрпЖропрпНроорпБро▒рпИ рокрпЖро▒рокрпНрокроЯрпБроХро┐ро▒родрпБ...")
    elif language_option == "Franc╠зais":
        st.write("Re╠Бcupe╠Бration de la recette...")
    elif language_option == "р┤ор┤▓р┤пр┤╛р┤│р┤В":
        st.write("р┤▒р╡Жр┤╕р┤┐р┤кр╡Нр┤кр┤┐ р┤▓р┤нр┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир╡Б...")
    elif language_option == "р░др▒Жр░▓р▒Бр░Чр▒Б":
        st.write("р░╡р░Вр░Яр░Хр░В р░кр▒Кр░Вр░жр▒Бр░др▒Бр░ир▒Нр░ир░╛р░В...")
    elif language_option == "р▓Хр▓ир│Нр▓ир▓б":
        st.write("р▓кр▓╛р▓Хр▓╡р▓┐р▓зр▓╛р▓ир▓╡р▓ир│Нр▓ир│Б р▓кр▓бр│Жр▓пр│Бр▓др│Нр▓др▓┐р▓жр│Ж...")
    elif language_option == "рд╣рд┐рдиреНрджреА":
        st.write("рд░реЗрд╕рд┐рдкреА рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд░рд╣реА рд╣реИ...")
    recipe_instructions = get_recipe(st.session_state.recipe_name)
    st.session_state.messages.append({"role": "assistant", "content": recipe_instructions})
    st.rerun()

# --- Audio control section removed ---
